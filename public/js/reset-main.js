// Generated by CoffeeScript 1.9.3
(function() {
  var getToken, validateToken, validated;

  window.isValid = false;

  getToken = function() {
    var token, url;
    url = window.location.href;
    return token = url.split('?')[1];
  };

  validateToken = function(token) {
    var callback;
    callback = validated;
    return $.ajax({
      url: PARTNER_API_LINK + "/partners/v1/token/reset",
      crossDomain: "true",
      type: "GET",
      beforeSend: function(request) {
        return request.setRequestHeader('Authorization', 'Basic ' + btoa(':' + token));
      },
      success: function(data) {
        window.isValid = true;
        return callback();
      },
      error: function(xhr, status, error) {
        return window.isValid = false;
      }
    });
  };

  validated = function() {
    if (isValid) {
      return $('#reset').fadeIn();
    }
  };

  $(document).ready(function() {
    var pattern, token;
    pattern = Trianglify({
      height: 3000,
      width: 3000,
      cell_size: 40
    });
    document.getElementById("body_background").style.backgroundImage = "url('images/background.png')";
    token = getToken();
    console.log(token);
    return $('#password_reset_form').on('submit', function(event) {
      var admin_token;
      $('#reset_password_error').text("");
      event.preventDefault();
      admin_token = token;
      return $.ajax({
        url: "/partners/v1/token/reset",
        crossDomain: "true",
        type: "POST",
        data: {
          password: $('#password1').val()
        },
        success: function(data) {
          return setTimeout((function() {
            window.location.replace('index.html');
            return success_modal.$el.modal('hide');
          }), 3000);
        },
        error: function(data) {
          return $('#reset_password_error').text("Could not change your password. Please try again.");
        }
      });
    });
  });

}).call(this);
